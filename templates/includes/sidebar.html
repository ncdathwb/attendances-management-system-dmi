<!-- Sidebar Navigation -->
<div class="sidebar">
    <div class="sidebar-header">
        <h3><i class="fas fa-clock me-2"></i>Chấm công</h3>
    </div>

    {% if user %}
    <div class="user-profile">
        <div class="user-avatar">
            <i class="fas fa-user"></i>
        </div>
        <div class="user-info">
            <h4>{{ user.name }}</h4>
            <p>Mã NV: {{ user.employee_id }}</p>
            <p>{{ user.department }}</p>
            <span id="current-user-name" style="display: none;">{{ user.name }}</span>

            {% if user.roles and ',' in user.roles %}
            <div class="role-switcher" style="margin-top:10px;">
                <label for="role-select" style="font-weight:500;">Vai trò hiện tại:</label>
                <select id="role-select" class="form-select form-select-sm" style="margin-top:4px;">
                    {% set current_role = session.get('current_role', user.roles.split(',')[0]) %}
                    {% for role in user.roles.split(',') %}
                    <option value="{{ role }}" {% if role==current_role %}selected{% endif %}>
                        {% if role == 'EMPLOYEE' %}Nhân viên
                        {% elif role == 'TEAM_LEADER' %}Trưởng nhóm
                        {% elif role == 'MANAGER' %}Quản lý
                        {% elif role == 'ADMIN' %}Quản trị viên
                        {% else %}{{ role }}{% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <ul class="nav-menu">
        <!-- Trang chủ -->
        <li class="nav-item">
            <a href="{{ url_for('dashboard') }}" class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}">
                <i class="fas fa-home"></i>
                Trang chủ
            </a>
        </li>

        <!-- Admin menus -->
        {% if 'ADMIN' in session.get('roles', []) %}
        <li class="nav-item" id="adminUsersMenu" style="display: none;">
            <a href="{{ url_for('admin_users') }}" class="nav-link {% if request.endpoint == 'admin_users' %}active{% endif %}">
                <i class="fas fa-users"></i>
                Quản lý người dùng
            </a>
        </li>
        <li class="nav-item" id="adminDepartmentsMenu" style="display: none;">
            <a href="{{ url_for('admin_departments') }}" class="nav-link {% if request.endpoint == 'admin_departments' %}active{% endif %}">
                <i class="fas fa-building"></i>
                Quản lý phòng ban
            </a>
        </li>
        <li class="nav-item" id="adminHolidaysMenu" style="display: none;">
            <a href="{{ url_for('admin_holidays') }}" class="nav-link {% if request.endpoint == 'admin_holidays' %}active{% endif %}">
                <i class="fas fa-calendar-alt"></i>
                Quản lý ngày lễ
            </a>
        </li>
        <li class="nav-item" id="adminLeaveHistoryAllMenu" style="display: none;">
            <a href="{{ url_for('leave_history') }}" class="nav-link {% if request.endpoint == 'leave_history' %}active{% endif %}">
                <i class="fas fa-clipboard-list"></i>
                Lịch sử nghỉ phép
            </a>
        </li>
        {% endif %}

        <!-- Lịch sử chấm công -->
        <li class="nav-item" id="attendanceHistoryMenuWrapper" style="display: none;">
            <a href="#" class="nav-link" id="attendanceHistoryMenu">
                <i class="fas fa-calendar-alt"></i>
                Lịch sử chấm công
            </a>
        </li>

        <!-- Employee leave menus -->
        <li class="nav-item" id="employeeLeaveMenu" style="display: none;">
            <a href="{{ url_for('leave_request_form') }}" class="nav-link {% if request.endpoint == 'leave_request_form' %}active{% endif %}">
                <i class="fas fa-calendar-plus"></i>
                Đăng ký nghỉ phép
            </a>
        </li>
        <li class="nav-item position-relative" id="employeeLeaveStatusMenu" style="display: none;">
            <a href="{{ url_for('leave_requests_list') }}" class="nav-link {% if request.endpoint == 'leave_requests_list' %}active{% endif %}">
                <i class="fas fa-list-alt"></i>
                Theo dõi tình trạng
                {% if leave_requests %}
                {% set rejected_count_sidebar = leave_requests|selectattr('status','equalto','rejected')|list|length %}
                {% if rejected_count_sidebar > 0 %}
                <span class="badge bg-danger position-absolute" style="right: 12px; top: 8px;">{{ rejected_count_sidebar }}</span>
                {% endif %}
                {% endif %}
            </a>
        </li>
        <li class="nav-item" id="employeeLeaveHistoryMenu" style="display: none;">
            <a href="{{ url_for('leave_history') }}" class="nav-link {% if request.endpoint == 'leave_history' %}active{% endif %}">
                <i class="fas fa-history"></i>
                Lịch sử nghỉ phép
            </a>
        </li>

        <!-- Manager leave approval menu -->
        <li class="nav-item" id="managerLeaveMenu" style="display: none;">
            <a href="{{ url_for('leave_requests_list') }}" class="nav-link position-relative {% if request.endpoint == 'leave_requests_list' %}active{% endif %}">
                <i class="fas fa-calendar-check"></i>
                Nghỉ phép cần phê duyệt
                <span id="pendingLeaveCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                    0
                </span>
            </a>
        </li>

        <!-- Settings - Chỉ hiển thị cho ADMIN và EMPLOYEE -->
        {% set current_role = session.get('current_role', '') %}
        {% if current_role not in ['MANAGER', 'TEAM_LEADER'] %}
        <li class="nav-item" id="settingsMenu">
            <a href="{{ url_for('settings') }}" class="nav-link {% if request.endpoint == 'settings' %}active{% endif %}">
                <i class="fas fa-user-cog"></i>
                Cài đặt
            </a>
        </li>
        {% endif %}

        <!-- Logout -->
        <li class="nav-item">
            <a href="{{ url_for('logout') }}" class="nav-link">
                <i class="fas fa-sign-out-alt"></i>
                Đăng xuất
            </a>
        </li>
    </ul>
</div>
