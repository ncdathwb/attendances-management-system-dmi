{% extends "base/base.html" %}

{% block title %}Chữ ký cá nhân - DMI Attendance{% endblock %}

{% block meta %}
<meta name="csrf-token" content="{{ csrf_token() }}">
{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/personal-signature.css') }}">
{% endblock %}

{% block body_class %}personal-signature-page{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-signature me-2"></i>Quản lý chữ ký cá nhân</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Hướng dẫn:</strong> Chữ ký cá nhân sẽ được sử dụng tự động khi bạn phê duyệt các bản ghi chấm công.
                        Hệ thống sẽ tự động tối ưu hóa chất lượng chữ ký để đảm bảo hiển thị rõ ràng trên các tài liệu.
                    </div>

                    <form method="POST" id="signature-form">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Vùng ký tên:</label>
                                    <div class="border rounded p-3 bg-white">
                                        <canvas id="signature-pad" width="600" height="200" style="border: 1px solid #ccc; background-color: white;"></canvas>
                                    </div>
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-secondary btn-sm" onclick="clearSignature()">
                                            <i class="fas fa-eraser me-1"></i>Xóa chữ ký
                                        </button>
                                        <button type="button" class="btn btn-info btn-sm" onclick="validateSignature()">
                                            <i class="fas fa-check-circle me-1"></i>Kiểm tra chất lượng
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="signature-preview" id="signature-preview">
                                    <h6 class="text-muted">Xem trước chữ ký</h6>
                                    <div id="preview-content">
                                        <i class="fas fa-signature fa-3x text-muted"></i>
                                        <p class="text-muted mt-2">Ký tên để xem trước</p>
                                    </div>
                                </div>

                                <div id="quality-indicator" class="signature-quality-indicator" style="display: none;">
                                    <h6><i class="fas fa-chart-line me-2"></i>Chất lượng chữ ký</h6>
                                    <div class="quality-score" id="quality-score"></div>
                                    <div class="recommendations" id="recommendations"></div>
                                </div>
                            </div>
                        </div>

                        <input type="hidden" name="signature" id="signature-input">

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-primary" onclick="return saveSignature()">
                                <i class="fas fa-save me-2"></i>Lưu chữ ký cá nhân
                            </button>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Quay lại Dashboard
                            </a>
                        </div>
                    </form>

                    {% if user.personal_signature %}
                    <div class="mt-4">
                        <h5><i class="fas fa-history me-2"></i>Chữ ký hiện tại:</h5>
                        <div class="border rounded p-3 bg-light">
                            <img src="{{ user.personal_signature }}" alt="Chữ ký cá nhân" style="max-width: 300px; max-height: 100px;">
                            <div class="mt-2">
                                <small class="text-muted">Chữ ký này sẽ được sử dụng tự động cho tất cả các lần phê duyệt</small>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
<script src="{{ url_for('static', filename='js/personal-signature.js') }}"></script>
{% endblock %}
